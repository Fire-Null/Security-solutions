
### کنترل دسترسی (Access control) سیاست‌هایی را اعمال می‌نماید که کاربران نتوانند خارج از مجوز‌های صادره، عملی انجام دهند. تخریب این سیاست‌ها می‌تواند منجر به افشای اطلاعات غیرمجاز، اصلاح یا تخریب تمامی داده‌ها و یا انجام یک عمل تجاری خارج از محدودیت‌های کاربر شود. آسیب‌پذیری‌های رایج access control عبارت‌اند از:

* تخطی از سطوح دسترسی تعریف شده، که در آن دسترسی باید تنها برای قابلیت‌ها، نقش‌ها و یا کاربرانی خاص مجاز باشد؛ ولی برای هرکس قابل دسترس است.
* دور زدن سطوح دسترسی تعریف شده با ایجاد تغییر در URL )parameter tampering یا force (browsing، وضعیت برنامه‌کاربردی داخلی یا صفحه HTML و یا با استفاده از ابزارهای حمله برای تغییر در درخواست‌‌های API
* مشاهده و ویرایش حساب فردی دیگر، با استفاده از شناسه‌های منحصر به فرد آن حساب insecure direct object references   یا IDOR
دسترسی به  API، زمانی که کنترل‌های دسترسی روی متد‌های POST، PUT  و DELETE تعریف نشده است.
* ارتقای سطح دسترسی یا فعالیت به عنوان یک کاربر، زمانی که ورود انجام نشده است و فعالیت به عنوان یک ادمین، زمانی که با حساب کاربری معمولی ورود صورت گرفته است.
* دستکاری  Metadata؛ به عنوان مثال بازتولید یا تغییر در توکن‌های کنترل دسترسی JWT یا JSON Web Token، کوکی‌ها و یا فیلد‌های پنهان به منظور ارتقای سطح دسترسی یا سوء استفاده از JWTهای نامعتبر.
* پیکربندی نادرست CORS که به منابع نامعتبر و غیرقابل اعتماد اجازه دسترسی به APIها را می‌دهد.
* دسترسی به صفحات معتبر با استفاده از حساب کاربری نامعتبر یا دسترسی به صفحات رده بالا به عنوان کاربر استاندارد (عادی).

### راهکارهای پیشگیری
#### باید توجه داشت که کنترل سطح دسترسی تنها در کد سمت سرور یا API های Server-less موثر خواهد بود زیرا فقط در این صورت نفوذگر قادر به کنترل یا تغییر Metadata نخواهد بود.

* دسترسی به منابع را جز هنگام استفاده از منابع عمومی به صورت پیشفرض رد نمایید.
* اجرای یکباره مکانیزم‌های کنترل سطوح دسترسی و استفاده مجدد آن در برنامه کاربردی و به حداقل رسانی استفاده از  Cors(اشتراک منابع با مبدا‌های خارجی)
* مدل‌های کنترل دسترسی باید روی مالکیت رکورد‌ها تاکید داشته باشد و نباید ایجاد، خواندن، بروزرسانی یا حذف رکورد‌ها را توسط کاربر بپذیرد.
* الزامات یکتا محدودیت کسب و کار برنامه (application business limit) باید توسط Domain   models  اجرا شوند.
* اطمینان از عدم فعال بودن directory listing، Metadata  فایل‌ها، وجود فایل‌های پشتیبان در آدرس root
* logشکست‌های کنترل دسترسی و ارسال هشدار به مدیر در مواقع مناسب (برای مثال هنگام شکست‌های متعدد).
* محدودسازی سرعت API و دسترسی به کنترلرها به منظور عدم ایجاد مشکل توسط ابزارهای حمله خودکار.
شناسه‌ نشست‌های Stateful پس از خروج از سیستم باید در سمت سرور بی‌اعتبار شوند. توکن‌های     Stateless JWT باید عمری کوتاه داشته باشند بطوری که فرصت‌ها برای نفوذ مهاجم به حداقل رسانیده شود. در صورتی که نیاز به توکن‌های JWT با عمری بالا دارید، پیشنهاد می‌شود از استاندارد‌های OAuth برای ابطال دسترسی پیروی کنید.


> نمونه‌هایی از سناریو حمله

1- برنامه کاربردی از داده‌های اعتبارسنجی نشده برای یک تماس SQL که به اطلاعات حساب‌ دسترسی دارد، بهره می‌گیرد:
``` c#
pstmt.setString(1, request.getParameter("acct"));

ResultSet results = pstmt.executeQuery( );
```
> یک مهاجم می‌تواند به راحتی با تغییر پارامتر acct در مرورگر هر عدد دلخواهی را ارسال کند و درصورتی که این پارامتر به درستی اعتبارسنجی نشده باشد، مهاجم قادر خواهد بود که به حساب کاربری مذکور دسترسی یابد.
```url 
https://example.com/app/accountInfo?acct=notmyacct
```
2- یک مهاجم بسادگی آدرس‌های زیر را در ابتدا کشف و سپس به آن ورود می‌کند اما برای دسترسی به صفحات مدیریتی نیاز به دسترسی ادمین می‌باشد.
```url
https://example.com/app/getappInfo

https://example.com/app/admin_getappInfo
```
>در صورتی که کاربری بدون انجام احراز هویت و یا بدون داشتن سطح دسترسی ادمین به این صفحات دسترسی یابد، یک نقض خواهد بود.
